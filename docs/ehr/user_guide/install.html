<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <!--[if lte IE 8]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <title>EHR Interoperability Framework - How to install</title>
        <meta name="author" content="Stelios Sfakianakis"/>
        <meta http-equiv="X-UA-Compatible" content="chrome=1"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link rel="stylesheet" type="text/css" href="style.css" media="screen">
    </head>
    <body>
        <div id="content">
            <nav id="sidebar">
            <div>
                <a href="../../manuals.html">&#xAB; iCARDEA User Guides</a>
            </div>  
            <h1>iCARDEA EHR Interoperability Framework</h1>
            <h2>Table of Contents</h2>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="start.html">How to start</a></li>
                <li><a href="install.html">How to install</a></li>
                <li><a href="use.html">How to use</a>
                <ul>
                    <li><a href="use.html#idp">Id Provider &#171;</a></li>
                    <li><a href="use.html#pixm">PIX Manager &#171;</a></li>
                    <li><a href="use.html#cded">CDA Editor &#171;</a></li>
                </ul>
                </li>
                <li><a href="technical.html">Technical Details</a></li>
            </ul>
            </nav>
            <div id="main">
                <h2 id="how-to-install">How to install</h2>

<p>In this section we describe the installation instructions for the EHR
Interoperability Framework. Please keep in mind that even if the code is
portable and operating system independent to a large extent, we assume that the
installation is performed in a MS Windows (32bit) server machine. We have
tested the instructions on Windows XP but they should be valid also for newer
versions like Vista and Windows 7.</p>

<p>This section contains the following installation instructions:</p>

<ul>
  <li><a href="#pre">Prerequisites</a> that are used by more than one component,</li>
  <li><a href="#idp">OpenId Provider</a>, the Identity Provider in the iCARDEA platform
that enables Single Sign On functionality for the iCARDEA web
applications.</li>
  <li><a href="#xds">XDS Registry, Update Broker, and Patient Index</a>,</li>
  <li><a href="#pixm">PIX Manager</a>, the web based user interface for managing PIX,</li>
  <li><a href="#cdaed">CDA Editor</a> for constructing from scratch or editing CDA
documents, and</li>
  <li><a href="#audit">OpenATNA audit repository</a>, an optional component, for
logging purposes</li>
</ul>

<p>Finally there is some <a href="#conf">configuration</a> information.</p>

<h3 id="pre">Prerequisites</h3>

<p>Before we install the EHR Interoperability Framework we need to make
sure that we have installed the following prerequisites:</p>

<ul>
  <li>
    <p><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java JDK</a>. 
You need to install version 6 and above.</p>
  </li>
  <li>
    <p>Also in relation to Java you need to install <a href="http://maven.apache.org/download.html">Apache
Maven</a> software version 3 as well.</p>
  </li>
  <li>
    <p>The <a href="http://httpd.apache.org/">Apache HTTPd</a> web server with
<a href="http://php.net/">PHP</a> support is also needed. Some documentation about how to
install PHP and Apache on MS Windows can be found
<a href="http://www.thesitewizard.com/php/install-php-5-apache-windows.shtml">here</a>.</p>
  </li>
  <li>
    <p><a href="http://www.mongodb.org/">mongoDB</a> is the database management system
(of the <a href="http://en.wikipedia.org/wiki/NoSQL">noSQL</a> genre) used to store the
EHR data. At the <code>tools_resources</code> directory you can find a
<a href="https://www.srdc.com.tr/svn/iCardea/tools_resources/python/mongodb-win32-i386-1.8.3.zip">zip</a>
file of the most recent stable version of mongoDB for Windows 32bit.</p>
  </li>
  <li>
    <p><a href="http://www.python.org/getit/">Python</a>. You need to install Python
version 2.6 or 2.7 which is the most current (in the 2.x branch<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>) at the
time of this writing. You can find the
<a href="https://www.srdc.com.tr/svn/iCardea/tools_resources/python/python-2.7.1.msi">setup</a>
of the most recent Python version (2.7.1, at the for time of this writing)
for Windows 32bit in the <code>tools_resources/python</code> directory.</p>
  </li>
  <li>
    <p>The python code requires some additional libraries. Most of them can be found
in Windows installable form in the <a href="http://icardea.googlecode.com/svn/trunk/">iCARDEA SVN
repository</a> inside the
<a href="http://icardea.googlecode.com/svn/trunk/tools_resources/python">tools_resources/python</a>
directory.</p>

    <ul>
      <li>
        <p><a href="http://pypi.python.org/pypi/setuptools">EasyInstall</a> will make
more easy the installation of the additional libraries. You can find a
<a href="https://www.srdc.com.tr/svn/iCardea/tools_resources/python/setuptools-0.6c11.win32-py2.7.exe">setup</a>
for Windows 32bit in <code>tools_resources/python</code> directory.</p>
      </li>
      <li>
        <p><a href="http://lxml.de/installation.html">lxml</a> You can find a
<a href="https://www.srdc.com.tr/svn/iCardea/tools_resources/python/lxml-2.3.win32-py2.7.exe">setup</a>
for Windows 32bit in <code>tools_resources/python</code> directory. Alternatively
you can install it by issuing<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>:</p>

        <pre><code>easy_install lxml
</code></pre>
      </li>
      <li>
        <p><a href="http://pypi.python.org/pypi/greenlet">greenlet</a> and
<a href="http://pypi.python.org/pypi/gevent">gevent</a><sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup> You can find a setup for
each of these lib
(<a href="https://www.srdc.com.tr/svn/iCardea/tools_resources/python/greenlet-0.3.1.win32-py2.7.exe">greenlet</a>
and
<a href="https://www.srdc.com.tr/svn/iCardea/tools_resources/python/gevent-0.13.3.win32-py2.7.exe">gevent</a>)
for Windows 32bit in <code>tools_resources/python</code> directory. Alternatively
you can install them by issuing</p>

        <pre><code>easy_install greenlet gevent
</code></pre>
      </li>
      <li>
        <p><a href="http://www.cherrypy.org/">cherrypy</a> (version 3.1.2) You can find a
<a href="https://www.srdc.com.tr/svn/iCardea/tools_resources/python/CherryPy-3.1.2.win32.exe">setup</a>
for Windows 32bit in <code>tools_resources/python</code> directory.  Alternatively
you can install it by issuing</p>

        <pre><code>easy_install cherrypy
</code></pre>
      </li>
      <li>
        <p><a href="http://pypi.python.org/pypi/pymongo/">pymongo</a> using this
<a href="https://www.srdc.com.tr/svn/iCardea/tools_resources/python/pymongo-2.0.1.win32-py2.7.exe">setup</a>
or by issuing</p>

        <pre><code>easy_install pymongo
</code></pre>
      </li>
      <li>
        <p><a href="http://pypi.python.org/pypi/Jinja2">Jinja2</a> (for the templates) by issuing</p>

        <pre><code>easy_install MarkupSafe bottle Jinja2
</code></pre>
      </li>
    </ul>
  </li>
</ul>

<h3 id="installation">Installation</h3>

<p>The code can be downloaded from the <a href="http://icardea.googlecode.com/">iCARDEA Google Code
repository</a>, and in particular it can be
found in the
<a href="http://icardea.googlecode.com/svn/trunk/icardea-interop-fmwork">icardea-interop-fmwork</a>
directory. In order to download the code, for the current being, you
need an SVN client and a good one for MS Windows is the
<a href="http://tortoisesvn.tigris.org/">TortoiseSVN</a>.</p>

<h4 id="idp">iCARDEA OpenID Provider</h4>
<p>This is an OpenID Provider for iCARDEA that supports the authentication of the
users using the Windows &lsquo;Domain Controller&rsquo;. </p>

<p>We assume a Windows machine is used for the installation of this server
since some windows specific APIs are used for authenticating users. Also
the code is written in <a href="http://www.python.org/">Python</a> and therefore it
should be the first to be installed.  Please keep in mind that we
support Python 2.x
(<a href="http://www.python.org/download/releases/2.7.2/">2.7.2</a> at the time of
this writting), i.e. <strong>not the 3.x</strong> version thereof!!</p>

<p>Now in addition to Python the following python modules should be installed:</p>

<ul>
  <li>
    <p><a href="http://starship.python.net/crew/mhammond/win32/Downloads.html">pywin32</a>.
You can find a setup for Python 2.7 in the
<a href="http://icardea.googlecode.com/svn/trunk/tools_resources/python/">tools_resources/python</a>
directory in the Google Code repository.</p>
  </li>
  <li>
    <p>Various python libs: bottle, jinja2, bottle_sqlite, python-openid,
beaker. You can install them all together either using
<a href="http://pypi.python.org/pypi/setuptools">easy_install</a>, or
<a href="http://pypi.python.org/pypi/pip">pip</a> or even by finding a <a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">Windows
precompiled binary</a>. For
example, you can use <code>easy_install</code> by issuing (assuming you have used
the default settings when installed Python 2.7): </p>

    <pre><code>   c:\Python27\Scripts\easy_install bottle jinja2 bottle_sqlite python-openid beaker
</code></pre>
  </li>
  <li>
    <p><a href="http://timgolden.me.uk/python/active_directory.html">active_directory</a>.
You can find a zip file containing the code in the
<a href="http://icardea.googlecode.com/svn/trunk/tools_resources/python/">tools_resources/python</a>
directory in the Google Code repository. You will need to unzip it in
a temporary file and then issue: <code>c:\Python27\python setup.py
install</code> in this directory.</p>
  </li>
</ul>

<p>The source code can be found in the <a href="http://code.google.com/p/icardea/">Google Code
 repository</a> of iCARDEA . You need to
 have an svn client (<a href="http://tortoisesvn.tigris.org/">TortoiseSVN</a> is a
 good one on Windows) and you need to checkout (read only) the
 <code>trunk/icardea-interop-fmwork/idprovider</code> path. You can check it out in
 the <code>c:\icardea\openid</code>  or similar directory.</p>

<p>You can run the server either as a standalone server or by employing the
 <a href="http://code.google.com/p/modwsgi/">mod_wsgi</a> module of Apache, which is the
 preferred option. In the second case you need to do the following:</p>

<ul>
  <li>
    <p>Download and install <a href="http://httpd.apache.org/download.cgi#apache22">Apache
 2.2</a> if you haven&rsquo;t done
 already.  The SSL version is preferred if you plan to secure the server
 (as you should!!).</p>
  </li>
  <li>
    <p>Download the <code>mod_wsgi.so</code> lib (the windows binary) from
<a href="http://code.google.com/p/modwsgi/downloads/detail?name=mod_wsgi-win32-ap22py27-3.3.so">http://code.google.com/p/modwsgi/downloads/detail?name=mod_wsgi-win32-ap22py27-3.3.so</a>
and place it in the modules dir of your Apache installation (normally
this should be something like <code>C:\Program Files\Apache Software
Foundation\Apache2.2\modules</code>).</p>
  </li>
  <li>
    <p>Load the module in the Apache configuration file (i.e. httpd.conf):</p>

    <pre><code>  LoadModule wsgi_module modules/mod_wsgi.so
</code></pre>
  </li>
  <li>
    <p>In the Apache Configuration file write the following (assuming that you have unzip
the code in the <code>c:\iCARDEA\openid</code>):</p>

    <pre><code>  Alias /idp/static C:/iCARDEA/openid/static
  &lt;Directory C:/iCARDEA/openid&gt;
      Order allow,deny
      Allow from all
  &lt;/Directory&gt;
  WSGIScriptAlias /idp C:/iCARDEA/openid/icardea_openid.py
</code></pre>
  </li>
  <li>
    <p>Now visit <a href="http://localhost/idp/">http://localhost/idp/</a> and you should be welcomed by the iCARDEA
Openid Server!</p>
  </li>
</ul>

<h4 id="xds">XDS Registry, Update Broker, and Patient Index</h4>

<p>The &ldquo;installation&rdquo; of these two components is a plain copy of the
contents of the SVN repository in some folder &ndash; there&rsquo;s no need for
running setup or other installation bundle, assuming that you have
installed Python and the rest of the <a href="#pre">prerequisites</a>. You just
need to create two new folders (e.g. in <code>c:\</code>) called (for example):
<code>c:\xds</code> and <code>c:\pixpdq</code> and put there the relevant code as downloaded
from the SVN repository. (The code for the XDS Registry and the Update
Broker should be in the same folder &ndash; they are in the same folder in
the SVN as well)</p>

<h4 id="pixm">PIX Manager</h4>

<p>The PIX Manager interface is a PHP application and needs to be put in
the <code>&lt;htdocs&gt;</code> directory of the Apache web server. In this so called
<code>document_root</code> directory, you can extract the PIX manager archive in a
folder named <code>PIXPDQ</code> (any folder will do, but for the <a href="use.html">user
guide</a> this is the assumed installation folder).</p>

<h4 id="cdaed">CDA Editor</h4>

<p>The CDA editor is a MS Windows desktop application and you need to run
the setup program in order to install it.</p>

<h4 id="audit">OpenATNA audit repository</h4>

<p>This is an optional component in the sense that all the components will
work even if it is not installed. More details about its installation
can be found <a href="audit.html">here</a>.</p>

<h3 id="conf">Configuration</h3>

<p>First of all the MongoDB database needs to be setup correctly, as follows:</p>

<ul>
  <li>
    <p>Create a <code>data</code> subdirectory inside the <code>bin</code> folder. This is the <strong>dbpath</strong> and all the
MongoDB databases will be persisted there.</p>
  </li>
  <li>
    <p>Create a <code>mongodb.conf</code> with the following contents (you need to
adjust properly for the <strong>dbpath</strong> variable, see
<a href="http://www.mongodb.org/display/DOCS/File+Based+Configuration">here</a> for more
details):</p>

    <pre><code>journal = true
dbpath = C:\mongodb\bin\data
directoryperdb = true
rest = true
</code></pre>
  </li>
</ul>

<div class="aside">
  <h3 id="notes">Notes</h3>

  <h4 id="cautionimgscautionpng-caution"><img src="imgs/caution.png" alt="caution" /> Caution</h4>
  <p>As described <a href="http://blog.mongodb.org/post/137788967">here</a>,</p>

  <blockquote>
    <p>MongoDB uses memory-mapped files for data storage, so for
servers managing more than 2GB of data you will definitely need the 64 bit
version (and a 64 bit version of Windows)</p>
  </blockquote>

  <h4 id="tipimgstippng-running-mongodb-as-windows-service"><img src="imgs/tip.png" alt="tip" /> Running MongoDB as Windows Service</h4>

  <p>In Windows you can install MongoDB to <a href="http://www.mongodb.org/display/DOCS/Windows+Service">run as a
service</a> by launching the
following command in a single line):</p>

  <pre><code> mongod --journal --rest
        --dbpath &lt;full path to the data folder&gt;
        --logpath &lt;full path to a log file&gt;
        --logappend --directoryperdb --install
</code></pre>

  <p>You can then start it from the Windows Services settings application or by
issuing:</p>

  <pre><code>mongod --service
</code></pre>

  <h4 id="tipimgstippng-testing-mongodb"><img src="imgs/tip.png" alt="tip" /> Testing MongoDB</h4>

  <p>The <a href="http://www.mongodb.org/display/DOCS/Http+Interface#HttpInterface-SimpleRESTInterface">REST interface of
MongoDB</a>
allows querying the database from your browser and it&rsquo;s a quick and dirty
approach to test things..</p>

</div>

<p>After this, the basic configuration for the EHR Interoperability Framework includes the
following:</p>

<ul>
  <li>
    <p>Change the line &ldquo;MONGO_HOST=&hellip;&rdquo; in <code>xds_config.py</code> if mongodb is
installed in a different machine instead of localhost. There are also
various settings like the ports that the XDS Registry and the Update
Broker are listening etc.</p>
  </li>
  <li>
    <p>For the Patient Index component you can change the configuration in
the file <code>config.ini</code> in the <code>hl7</code> folder. This file follows the <a href="http://en.wikipedia.org/wiki/INI_file">INI
format</a> and in section
<code>[server]</code> you can change the mongodb host, the TCP port of the
Patient Index, etc: </p>

    <pre><code>[server]
port=2575
mongo_host=localhost
application_name=NISTManager_SGSFAK
facility_name=NIST
</code></pre>

    <p>The rest of the &ldquo;sections&rdquo; correspond to identification (affinity)
domains. For each domain there&rsquo;s a namespace (i.e. a short name), a
<em>universal id</em> (the long unique name), and the <a href="http://www.med.mun.ca/tedhoekman/medinfo/hl7/ch200038.htm#I8"><em>universal
type</em></a>
specifying the type of the universal id used (it can be one of ISO,
UUID, and DNS). For example for the iCARDEA domain we have chosen to
use the following:</p>

    <pre><code>[icardea]
namespace=icardea.pix
universal_id=1.2.826.0.1.3680043.2.44.248240.1
universal_type=ISO
</code></pre>
  </li>
</ul>

<p>For the configuration of the PIX Manager web application two files need
to be configured (<code>&lt;home&gt;</code> is PIX manager&rsquo;s root directory in the web
server):</p>

<ul>
  <li><code>&lt;home&gt;\user\config\config.txt</code>:  contains the available domains</li>
  <li><code>&lt;home&gt;\user\config\server.txt</code>:  contains the PIX server ip and port</li>
</ul>

<p>For the configuration of the CDA Editor, in the installation directory
there is a configuration file <code>app.config.xml</code>. The following parameters
need to be configured in this file:</p>

<ul>
  <li>
    <p><code>sharedDir</code>: the directory path that CDA EDITOR stores the CDA
documents created. It is also the directory CDA EDITOR watches and
presents the existing CDA documents</p>
  </li>
  <li>
    <p><code>xds</code>: the url of the XDS service</p>
  </li>
  <li>
    <p><code>PIX_ip</code>: the IP of the machine the Patient Index (PIX) server is
running on</p>
  </li>
  <li>
    <p><code>PIX_port</code>: the port the Patient Index (PIX) server is running on</p>
  </li>
</ul>

<h2 id="footnotes">Footnotes</h2>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>The Python code has not been tested with 3.x branch<a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>NOTE: In Linux <code>lxml</code> requires <code>libxml2</code> and <code>libxslt</code> to be properly
  installed so you &lsquo;d better install these with the package
  management tool of your Linux distribution (e.g. <code>apt-get</code> in
  Debian/Ubuntu) to look for packages like <code>libxml2-dev</code> or
  <code>libxslt-devel</code> if the build with the <code>easy_install</code> fails.<a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>In Linux (and other <a href="http://en.wikipedia.org/wiki/Unix-like">*nix</a> systems) it also requires the
  installation of libevent.<a href="#fnref:3" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>

                <footer id="footer">
                &copy; 2011 - 2012 <a href="http://www.ics.forth.gr/">Institute of Computer Science, FORTH</a>
                </footer>
            </div>
        </div>

        <!-- 
        <script type="text/javascript" 
            src="//ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>

        <script>
            window.onload = function() {
                CFInstall.check({
                    mode: "overlay"
                });
            };
        </script>
        -->
    </body>
</html>
